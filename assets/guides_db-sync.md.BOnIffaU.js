import{_ as i,o as a,c as n,ag as e}from"./chunks/framework.Bo7atV7P.js";const c=JSON.parse('{"title":"Database Sync","description":"","frontmatter":{},"headers":[],"relativePath":"guides/db-sync.md","filePath":"guides/db-sync.md","lastUpdated":1772113971000}'),t={name:"guides/db-sync.md"};function p(l,s,h,k,d,r){return a(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="database-sync" tabindex="-1">Database Sync <a class="header-anchor" href="#database-sync" aria-label="Permalink to &quot;Database Sync&quot;">​</a></h1><p>The setup runtime includes an optional database sync step that pulls a remote database into your local environment during setup.</p><h2 id="enable-database-sync" tabindex="-1">Enable database sync <a class="header-anchor" href="#enable-database-sync" aria-label="Permalink to &quot;Enable database sync&quot;">​</a></h2><p>In <code>scripts/.env.setup</code>:</p><div class="language-dotenv vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dotenv</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">SETUP_DB_SYNC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true</span></span></code></pre></div><p>Or pass <code>--with-db-sync true</code> when initializing a project:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scripts/setup-core/bin/webentor-setup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --project</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-project</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --with-db-sync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span></code></pre></div><p>This records <code>withDbSync: true</code> in <code>.webentor/project.json</code> and sets the toggle in <code>scripts/.env.setup</code>.</p><h2 id="hook-integration" tabindex="-1">Hook integration <a class="header-anchor" href="#hook-integration" aria-label="Permalink to &quot;Hook integration&quot;">​</a></h2><p>Database sync is surrounded by two hooks:</p><table tabindex="0"><thead><tr><th>Hook</th><th>When</th></tr></thead><tbody><tr><td><code>pre-db-sync</code></td><td>Before the sync step runs</td></tr><tr><td><code>post-db-sync</code></td><td>After the sync completes</td></tr></tbody></table><p>Implement the actual sync logic in <code>scripts/hooks/pre-db-sync.sh</code> or a project-specific helper. The runtime step itself only triggers the hooks — you supply the download and import commands.</p><h3 id="example-ssh-dump-import" tabindex="-1">Example: SSH dump import <a class="header-anchor" href="#example-ssh-dump-import" aria-label="Permalink to &quot;Example: SSH dump import&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># scripts/hooks/pre-db-sync.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Pulling database from staging...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy@staging.example.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;wp db export --allow-root - | gzip -c&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/staging.sql.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gunzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/staging.sql.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/staging.sql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/staging.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Running search-replace for local URL...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search-replace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://staging.example.com&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;http://myproject.test&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --skip-columns=guid</span></span></code></pre></div><h3 id="example-wp-cli-sync-from-remote-via-robo-deployer" tabindex="-1">Example: WP-CLI sync from remote via Robo/Deployer <a class="header-anchor" href="#example-wp-cli-sync-from-remote-via-robo-deployer" aria-label="Permalink to &quot;Example: WP-CLI sync from remote via Robo/Deployer&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># scripts/hooks/pre-db-sync.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-drop-table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/backup.sql</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # local backup first</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./vendor/bin/dep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> staging</span></span></code></pre></div><h2 id="post-sync-cleanup" tabindex="-1">Post-sync cleanup <a class="header-anchor" href="#post-sync-cleanup" aria-label="Permalink to &quot;Post-sync cleanup&quot;">​</a></h2><p>Use <code>post-db-sync</code> to run additional WP-CLI commands after the database is imported:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># scripts/hooks/post-db-sync.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flush</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> siteurl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eval &#39;echo home_url();&#39;)&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user_pass=password</span></span></code></pre></div><h2 id="multisite-notes" tabindex="-1">Multisite notes <a class="header-anchor" href="#multisite-notes" aria-label="Permalink to &quot;Multisite notes&quot;">​</a></h2><p>Multisite search-replace requires iterating over all sites:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For WordPress multisite</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search-replace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://staging.example.com&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;http://myproject.test&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --network</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --skip-columns=guid</span></span></code></pre></div><blockquote><p><strong>Note:</strong> Automated multisite DB sync is not yet built into the setup runtime. For multisite projects, implement the full sync logic in <code>pre-db-sync.sh</code>.</p></blockquote><h2 id="skipping-db-sync-in-ci" tabindex="-1">Skipping DB sync in CI <a class="header-anchor" href="#skipping-db-sync-in-ci" aria-label="Permalink to &quot;Skipping DB sync in CI&quot;">​</a></h2><p>In CI/CD pipelines, DB sync is typically unwanted. Ensure <code>SETUP_DB_SYNC=false</code> is set in your pipeline environment or in the CI-specific <code>.env.setup</code> override.</p>`,25)])])}const F=i(t,[["render",p]]);export{c as __pageData,F as default};
