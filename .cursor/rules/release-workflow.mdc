---
description: Monorepo release workflow for package versioning, publishing, and mirror handoff
alwaysApply: false
---

# Webentor Release Workflow

Use these steps whenever a request involves releasing, versioning, publishing, or post-release validation.

## Critical Rule

**NEVER manually edit version numbers (`package.json`, `composer.json`) or `CHANGELOG.md`
for Changesets-managed packages (`webentor-core`, `webentor-configs`).**
Changesets automation handles all of these. Manual edits cause double-bumps.

## Step-by-step Release Flow

1. Create a changeset:
   - Run `pnpm changeset`.
   - Select affected package(s) and semver bump type (`patch` / `minor` / `major`).
   - Write a short, user-facing summary of the changes.
   - Commit and push the `.changeset/*.md` file to `main`.
2. Automated "Version Packages" PR:
   - `release.yml` runs on push to `main`.
   - Changesets action runs `pnpm version-packages` which:
     - `changeset version` — bumps `package.json`, updates `CHANGELOG.md`, deletes consumed changeset.
     - `node scripts/sync-composer-versions.mjs` — syncs the new version into sibling `composer.json`.
   - A "Version Packages" PR is opened/updated on `changeset-release/main`.
3. Review and merge the PR:
   - The PR contains version bumps, changelog updates, and synced `composer.json`.
   - Merging triggers `changeset publish` → npm publish.
4. Post-publish manual steps:
   - Update `docs/src/compatibility-matrix.md` with the new version set.
   - Push a namespaced tag to trigger the split-mirror workflow:
     - `core-v*` -> `split-webentor-core.yml` (also pings Packagist)
     - `setup-v*` -> `split-webentor-setup.yml`
     - `starter-v*` -> `split-webentor-starter.yml`
   - Example: `git tag core-v0.9.14 && git push origin core-v0.9.14`

## What is automated vs. manual

| Step | Automated | Manual |
|---|---|---|
| `package.json` version bump | Yes (Changesets) | NO |
| `composer.json` version sync | Yes (`sync-composer-versions.mjs`) | NO |
| `CHANGELOG.md` update | Yes (Changesets) | NO |
| npm publish | Yes (`changeset publish`) | NO |
| Changeset file creation | — | Yes (`pnpm changeset`) |
| Compatibility matrix update | — | Yes |
| Namespaced tag for mirror | — | Yes |
| Packagist update | Yes (API ping in split workflow) | NO |

## Guardrails

- Only `webentor-core` and `webentor-configs` are npm-published via Changesets.
- `webentor-core`, `webentor-setup`, and `webentor-starter` are delivered via split-mirror workflows for standalone repositories.
- Changesets baseline config is `.changeset/config.json` (`baseBranch: main`, `access: public`).
- Required GitHub secrets:
  - `CORE_MIRROR_REPO`, `CORE_MIRROR_TOKEN` — for core split mirror
  - `PACKAGIST_USERNAME`, `PACKAGIST_API_TOKEN` — for Packagist ping
  - `WEBENTOR_DEMO_REPO`, `WEBENTOR_DEMO_TOKEN` — for demo bump workflow

## Non-Changesets Packages

`webentor-setup`, `webentor-starter`, and `webentor-theme-v2` are NOT managed by Changesets.
For these packages, version bumps, changelog updates, and `composer.json` edits are manual.
See the "Version Source Map" section in `AGENTS.md` for the full list of files to update.
